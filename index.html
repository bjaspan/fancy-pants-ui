<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate Judging</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a native app feel */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        /* Style for the radio buttons to look like a segmented control */
        .radio-label {
            @apply block w-full cursor-pointer rounded-lg border border-gray-600 bg-gray-700 py-3 px-4 text-center text-sm font-medium text-gray-300 transition-all duration-200 ease-in-out;
        }
        /* Hide elements by default */
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-inter">

    <div class="max-w-md mx-auto min-h-screen bg-gray-800 shadow-lg p-6">
        <h1 id="race-title" class="text-3xl font-bold text-center text-white mb-6">Gate Judging</h1>

        <form id="statForm" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSe8BGyWb91SaPUdOfizgt0bZvLgCLwBp2P4gPCOHiruyRaOUw/formResponse" method="POST">

            <!-- Loading/Error State -->
            <div id="loading-state" class="text-center p-4">
                <p class="text-lg text-gray-300">Loading Race Data...</p>
                <p id="loading-error" class="text-red-400 mt-2"></p>
            </div>

            <!-- Main Form Content (hidden by default) -->
            <div id="form-content" class="hidden space-y-6">

                <!-- Station Selector (will be populated dynamically) -->
                <div>
                    <select id="station-selector" required class="block w-full rounded-lg border-gray-600 bg-gray-700 p-3 text-white placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="" disabled selected>Select a station</option>
                        <!-- Stations will be added here by JS -->
                    </select>
                </div>

                <!-- Bib Number (Text Input) -->
                <div id="bib-number-container" class="hidden">
                    <label for="bib-number" class="block text-sm font-medium text-gray-300 mb-2">Bib Number</label>
                    <input
                        type="text"
                        id="bib-number"
                        name="entry.1708578938"
                        required
                        class="block w-full rounded-lg border-gray-600 bg-gray-700 p-3 text-white placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        placeholder="e.g., 123"
                        inputmode="numeric">
                </div>

                <!-- 19 Radio Button Questions (Static in HTML, dynamic logic) -->
                <div id="gates-container" class="space-y-4 hidden">

                    <!-- Gate 1 -->
                    <div id="gate-row-1" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 1:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-1-clean" name="entry.55002585" value="Clean" class="hidden peer" required checked>
                                <label for="play-1-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-1-touch" name="entry.55002585" value="Touch" class="hidden peer">
                                <label for="play-1-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-1-fifty" name="entry.55002585" value="Fifty" class="hidden peer">
                                <label for="play-1-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 2 -->
                    <div id="gate-row-2" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 2:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-2-clean" name="entry.1855197499" value="Clean" class="hidden peer" required checked>
                                <label for="play-2-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-2-touch" name="entry.1855197499" value="Touch" class="hidden peer">
                                <label for="play-2-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-2-fifty" name="entry.1855197499" value="Fifty" class="hidden peer">
                                <label for="play-2-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 3 -->
                    <div id="gate-row-3" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 3:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-3-clean" name="entry.838150175" value="Clean" class="hidden peer" required checked>
                                <label for="play-3-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-3-touch" name="entry.838150175" value="Touch" class="hidden peer">
                                <label for="play-3-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-3-fifty" name="entry.838150175" value="Fifty" class="hidden peer">
                                <label for="play-3-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 4 -->
                    <div id="gate-row-4" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 4:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-4-clean" name="entry.2134907932" value="Clean" class="hidden peer" required checked>
                                <label for="play-4-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-4-touch" name="entry.2134907932" value="Touch" class="hidden peer">
                                <label for="play-4-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-4-fifty" name="entry.2134907932" value="Fifty" class="hidden peer">
                                <label for="play-4-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 5 -->
                    <div id="gate-row-5" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 5:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-5-clean" name="entry.76231793" value="Clean" class="hidden peer" required checked>
                                <label for="play-5-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-5-touch" name="entry.76231793" value="Touch" class="hidden peer">
                                <label for="play-5-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-5-fifty" name="entry.76231793" value="Fifty" class="hidden peer">
                                <label for="play-5-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 6 -->
                    <div id="gate-row-6" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 6:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-6-clean" name="entry.2014836299" value="Clean" class="hidden peer" required checked>
                                <label for="play-6-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-6-touch" name="entry.2014836299" value="Touch" class="hidden peer">
                                <label for="play-6-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-6-fifty" name="entry.2014836299" value="Fifty" class="hidden peer">
                                <label for="play-6-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 7 -->
                    <div id="gate-row-7" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 7:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-7-clean" name="entry.1263576022" value="Clean" class="hidden peer" required checked>
                                <label for="play-7-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-7-touch" name="entry.1263576022" value="Touch" class="hidden peer">
                                <label for="play-7-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-7-fifty" name="entry.1263576022" value="Fifty" class="hidden peer">
                                <label for="play-7-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 8 -->
                    <div id="gate-row-8" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 8:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-8-clean" name="entry.714148965" value="Clean" class="hidden peer" required checked>
                                <label for="play-8-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-8-touch" name="entry.714148965" value="Touch" class="hidden peer">
                                <label for="play-8-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-8-fifty" name="entry.714148965" value="Fifty" class="hidden peer">
                                <label for="play-8-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 9 -->
                    <div id="gate-row-9" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 9:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-9-clean" name="entry.2091158156" value="Clean" class="hidden peer" required checked>
                                <label for="play-9-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-9-touch" name="entry.2091158156" value="Touch" class="hidden peer">
                                <label for="play-9-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-9-fifty" name="entry.2091158156" value="Fifty" class="hidden peer">
                                <label for="play-9-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 10 -->
                    <div id="gate-row-10" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 10:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-10-clean" name="entry.954036935" value="Clean" class="hidden peer" required checked>
                                <label for="play-10-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-10-touch" name="entry.954036935" value="Touch" class="hidden peer">
                                <label for="play-10-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-10-fifty" name="entry.954036935" value="Fifty" class="hidden peer">
                                <label for="play-10-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 11 -->
                    <div id="gate-row-11" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 11:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-11-clean" name="entry.1849885105" value="Clean" class="hidden peer" required checked>
                                <label for="play-11-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-11-touch" name="entry.1849885105" value="Touch" class="hidden peer">
                                <label for="play-11-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-11-fifty" name="entry.1849885105" value="Fifty" class="hidden peer">
                                <label for="play-11-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 12 -->
                    <div id="gate-row-12" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 12:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-12-clean" name="entry.1598024978" value="Clean" class="hidden peer" required checked>
                                <label for="play-12-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-12-touch" name="entry.1598024978" value="Touch" class="hidden peer">
                                <label for="play-12-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-12-fifty" name="entry.1598024978" value="Fifty" class="hidden peer">
                                <label for="play-12-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 13 -->
                    <div id="gate-row-13" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 13:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-13-clean" name="entry.1849166482" value="Clean" class="hidden peer" required checked>
                                <label for="play-13-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-13-touch" name="entry.1849166482" value="Touch" class="hidden peer">
                                <label for="play-13-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-13-fifty" name="entry.1849166482" value="Fifty" class="hidden peer">
                                <label for="play-13-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 14 -->
                    <div id="gate-row-14" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 14:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-14-clean" name="entry.1790035018" value="Clean" class="hidden peer" required checked>
                                <label for="play-14-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-14-touch" name="entry.1790035018" value="Touch" class="hidden peer">
                                <label for="play-14-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-14-fifty" name="entry.1790035018" value="Fifty" class="hidden peer">
                                <label for="play-14-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 15 -->
                    <div id="gate-row-15" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 15:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-15-clean" name="entry.51888731" value="Clean" class="hidden peer" required checked>
                                <label for="play-15-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-15-touch" name="entry.51888731" value="Touch" class="hidden peer">
                                <label for="play-15-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-15-fifty" name="entry.51888731" value="Fifty" class="hidden peer">
                                <label for="play-15-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 16 -->
                    <div id="gate-row-16" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 16:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-16-clean" name="entry.1479632689" value="Clean" class="hidden peer" required checked>
                                <label for="play-16-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-16-touch" name="entry.1479632689" value="Touch" class="hidden peer">
                                <label for="play-16-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-16-fifty" name="entry.1479632689" value="Fifty" class="hidden peer">
                                <label for="play-16-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 17 -->
                    <div id="gate-row-17" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 17:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-17-clean" name="entry.331391847" value="Clean" class="hidden peer" required checked>
                                <label for="play-17-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-17-touch" name="entry.331391847" value="Touch" class="hidden peer">
                                <label for="play-17-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-17-fifty" name="entry.331391847" value="Fifty" class="hidden peer">
                                <label for="play-17-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 18 -->
                    <div id="gate-row-18" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 18:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-18-clean" name="entry.1598320935" value="Clean" class="hidden peer" required checked>
                                <label for="play-18-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-18-touch" name="entry.1598320935" value="Touch" class="hidden peer">
                                <label for="play-18-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-18-fifty" name="entry.1598320935" value="Fifty" class="hidden peer">
                                <label for="play-18-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Gate 19 -->
                    <div id="gate-row-19" class="hidden grid grid-cols-2 items-center gap-2">
                        <label class="font-medium text-gray-200">Gate 19:</label>
                        <div class="flex space-x-2" role="group">
                            <div class="flex-1">
                                <input type="radio" id="play-19-clean" name="entry.1176839769" value="Clean" class="hidden peer" required checked>
                                <label for="play-19-clean" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Clean
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-19-touch" name="entry.1176839769" value="Touch" class="hidden peer">
                                <label for="play-19-touch" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Touch
                                </label>
                            </div>
                            <div class="flex-1">
                                <input type="radio" id="play-19-fifty" name="entry.1176839769" value="Fifty" class="hidden peer">
                                <label for="play-19-fifty" class="radio-label hover:bg-gray-600 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-500 peer-checked:ring-2 peer-checked:ring-blue-500">
                                    Fifty
                                </label>
                            </div>
                        </div>
                    </div>

                </div> <!-- End of radio button container -->

                <!-- Time (Text Input) -->
                <div id="time-field-container" class="hidden">
                    <label for="time" class="block text-sm font-medium text-gray-300 mb-2">Time (MM:SS.HH)</label>
                    <input
                        type="text"
                        id="time"
                        name="entry.873039571"
                        required
                        class="block w-full rounded-lg border-gray-600 bg-gray-700 p-3 text-white placeholder-gray-400 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        placeholder="e.g., 01:45.23"
                        pattern="\d{1,2}:\d{2}\.\d{2}"
                        title="Please enter time in MM:SS.HH format"
                        inputmode="numeric">
                </div>

                <!-- Status Message -->
                <div id="statusMessage" class="hidden text-center text-sm font-medium p-3 rounded-lg"></div>

                <!-- Button Container -->
                <div class="space-y-4">
                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="submitButton"
                        class="flex w-full justify-center rounded-lg bg-blue-600 py-3 px-4 text-lg font-semibold text-white shadow-sm transition-all duration-200 ease-in-out hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:opacity-50">
                        Submit
                    </button>

                    <!-- Reset Button -->
                    <button
                        type="button"
                        id="resetButton"
                        class="flex w-full justify-center rounded-lg bg-gray-600 py-2 px-4 text-sm font-medium text-gray-200 shadow-sm transition-all duration-200 ease-in-out hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                        Change Station
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {

            const form = document.getElementById('statForm');
            const submitButton = document.getElementById('submitButton');
            const statusMessage = document.getElementById('statusMessage');
            const timeInput = document.getElementById('time');

            const stationSelector = document.getElementById('station-selector');
            const bibNumberContainer = document.getElementById('bib-number-container');
            const gatesContainer = document.getElementById('gates-container');
            const timeFieldContainer = document.getElementById('time-field-container');
            const resetButton = document.getElementById('resetButton');

            const raceTitleElement = document.getElementById('race-title');
            const loadingState = document.getElementById('loading-state');
            const loadingError = document.getElementById('loading-error');
            const formContent = document.getElementById('form-content');

            // Store the dynamically generated map
            let stationGateMap = {};
            let isFinishStation = {};

            // const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSe8BGyWb91SaPUdOfizgt0bZvLgCLwBp2P4gPCOHiruyRaOUw/viewform'; // No longer needed

            async function fetchAndParseMetadata() {
                try {
                    // Fetch the raw JSON file from the same origin
                    // Add a cache-busting timestamp to ensure we get the latest file
                    // FIX: Prepend './' to make the URL relative to the current path, resolving blob: context issues
                    const response = await fetch(`./current_race.json?timestamp=${new Date().getTime()}`);

                    if (!response.ok) {
                        throw new Error(`Failed to load race data (HTTP ${response.status})`);
                    }

                    const metadata = await response.json();

                    // DEBUG: Log the fetched metadata
                    console.log("Fetched metadata:", metadata);

                    if (!metadata.race_name || !metadata.stations) {
                        throw new Error("Metadata is missing 'race_name' or 'stations'.");
                    }

                    return metadata;

                } catch (error) {
                    console.error("Error fetching or parsing metadata:", error);
                    loadingError.textContent = `Error: ${error.message}. Retrying in 5s...`;
                    return null;
                }
            }

            function buildStationUI(metadata) {
                // Set Race Title
                raceTitleElement.textContent = metadata.race_name || "Gate Judging";

                // Clear existing options (except "Select a station")
                while (stationSelector.options.length > 1) {
                    stationSelector.remove(1);
                }

                // Reset internal maps
                stationGateMap = {};
                isFinishStation = {};

                let startGate = 1;

                // Populate station selector and gate map
                metadata.stations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station.name;
                    option.textContent = station.name;
                    stationSelector.appendChild(option);

                    isFinishStation[station.name] = !!station.is_finish;

                    if (station.is_finish) {
                        stationGateMap[station.name] = [];
                    } else if (station.max_gate) {
                        const endGate = station.max_gate;
                        stationGateMap[station.name] = [];
                        for (let i = startGate; i <= endGate; i++) {
                            stationGateMap[station.name].push(i);
                        }
                        startGate = endGate + 1;
                    }
                });
            }


            function updateFormVisibility() {
                const selectedStation = stationSelector.value;
                const visibleGateNumbers = stationGateMap[selectedStation] || [];

                // Show/Hide Bib Number Field
                if (selectedStation) {
                    bibNumberContainer.classList.remove('hidden');
                } else {
                    bibNumberContainer.classList.add('hidden');
                }

                // 1. Show/Hide Gates Container
                if (visibleGateNumbers.length > 0) {
                    gatesContainer.classList.remove('hidden');
                } else {
                    gatesContainer.classList.add('hidden');
                }

                // 2. Show/Hide and Enable/Disable Individual Gates
                for (let i = 1; i <= 19; i++) {
                    const row = document.getElementById(`gate-row-${i}`);
                    if (!row) continue;

                    const inputs = row.querySelectorAll('input[type="radio"]');
                    const isVisible = visibleGateNumbers.includes(i);

                    if (isVisible) {
                        row.classList.remove('hidden');
                        inputs.forEach(input => input.disabled = false);
                    } else {
                        row.classList.add('hidden');
                        inputs.forEach(input => input.disabled = true);
                    }
                }

                // 3. Show/Hide and Enable/Disable Time Field
                if (isFinishStation[selectedStation]) {
                    timeFieldContainer.classList.remove('hidden');
                    timeInput.disabled = false;
                } else {
                    timeFieldContainer.classList.add('hidden');
                    timeInput.disabled = true;
                }
            }

            async function initializeApp() {
                loadingState.classList.remove('hidden');
                loadingError.textContent = '';
                formContent.classList.add('hidden');

                let metadata = null;
                while (!metadata) {
                    metadata = await fetchAndParseMetadata();
                    if (!metadata) {
                        // Wait 5 seconds before retrying
                        await new Promise(resolve => setTimeout(resolve, 5000));
                    }
                }

                buildStationUI(metadata);

                loadingState.classList.add('hidden');
                formContent.classList.remove('hidden');

                // Reset form state and update visibility
                form.reset();
                updateFormVisibility();
            }

            // --- Event Listeners ---

            stationSelector.addEventListener('change', updateFormVisibility);

            timeInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^0-9]/g, '');

                if (value.length > 6) {
                    value = value.substring(0, 6);
                }

                if (value.length > 4) {
                    e.target.value = value.substring(0, value.length - 4) + ':' + value.substring(value.length - 4, value.length - 2) + '.' + value.substring(value.length - 2);
                } else if (value.length > 2) {
                    e.target.value = value.substring(0, value.length - 2) + ':' + value.substring(value.length - 2);
                } else {
                    e.target.value = value;
                }
            });

            form.addEventListener('submit', async function(event) {
                event.preventDefault();

                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                statusMessage.textContent = 'Submitting data...';
                statusMessage.className = 'block text-center text-sm font-medium p-3 rounded-lg bg-yellow-600 text-white';
                statusMessage.classList.remove('hidden');

                const formData = new FormData(form);
                const url = form.action;

                const selectedStation = stationSelector.value;

                try {
                    await fetch(url, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors'
                    });

                    statusMessage.textContent = 'Success! Stats submitted.';
                    statusMessage.className = 'block text-center text-sm font-medium p-3 rounded-lg bg-green-600 text-white';

                    form.reset();
                    stationSelector.value = selectedStation;
                    window.scrollTo(0, 0);
                    updateFormVisibility();

                    setTimeout(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Submit';
                        statusMessage.classList.add('hidden');
                    }, 2000);

                } catch (error) {
                    console.error('Error submitting form:', error);
                    statusMessage.textContent = 'Error: Submission failed. Check connection.';
                    statusMessage.className = 'block text-center text-sm font-medium p-3 rounded-lg bg-red-600 text-white';
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit';
                }
            });

            resetButton.addEventListener('click', function() {
                // Re-initialize the app, which re-fetches metadata and resets the form
                initializeApp();
                statusMessage.classList.add('hidden');
                window.scrollTo(0, 0);
            });

            // Initial load
            initializeApp();
        });
    </script>

</body>
</html>
